name: Prueba Final Caro - El Rastreador
on:
  workflow_dispatch:

jobs:
  build_ios:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Rastrear Proyecto e Instalar
        run: |
          # 1. Buscamos d칩nde est치 el archivo .xcodeproj realmente
          PROYECTO_PATH=$(find . -name "*.xcodeproj" -not -path "*/Pods/*" | head -n 1)
          DIRECTORIO=$(dirname "$PROYECTO_PATH")
          NOMBRE_PROYECTO=$(basename "$PROYECTO_PATH")
          
          echo "Encontramos el proyecto en: $DIRECTORIO"
          echo "Nombre del archivo: $NOMBRE_PROYECTO"
          
          cd "$DIRECTORIO"
          
          # 2. Creamos el Podfile din치mico
          cat <<EOF > Podfile
          platform :ios, '15.0'
          project '$NOMBRE_PROYECTO'
          use_frameworks!
          target 'AnalyticsExample' do
            pod 'FirebaseAnalytics'
          end
          EOF
          
          pod install

      - name: Compilar para Simulador
        run: |
          PROYECTO_PATH=$(find . -name "*.xcodeproj" -not -path "*/Pods/*" | head -n 1)
          DIRECTORIO=$(dirname "$PROYECTO_PATH")
          cd "$DIRECTORIO"
          
          # Buscamos el workspace que cre칩 CocoaPods
          WORKSPACE=$(ls | grep .xcworkspace)
          
          xcodebuild -workspace "$WORKSPACE" \
            -scheme AnalyticsExample \
            -configuration Debug \
            -sdk iphonesimulator \
            -derivedDataPath build \
            -quiet

      - name: Guardar App para Appetize
        uses: actions/upload-artifact@v4
        with:
          name: app-simulador
          path: "**/build/Build/Products/Debug-iphonesimulator/*.app"
